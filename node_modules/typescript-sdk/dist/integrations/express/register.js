"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.keploy = void 0;
// @ts-ignore
const require_in_the_middle_1 = __importDefault(require("require-in-the-middle"));
const middleware_1 = __importDefault(require("./middleware"));
const keploy_1 = __importDefault(require("../../src/keploy"));
const body_parser_1 = __importDefault(require("body-parser"));
const cors_1 = __importDefault(require("cors"));
const merge_descriptors_1 = __importDefault(require("merge-descriptors"));
const keploy = new keploy_1.default();
exports.keploy = keploy;
// @ts-ignore
(0, require_in_the_middle_1.default)(["express"], function (exports) {
    const expressApp = exports;
    function keployWrappedExpress() {
        const keployApp = expressApp();
        keployApp.use(body_parser_1.default.json());
        keployApp.use((0, cors_1.default)());
        keployApp.use((0, middleware_1.default)(keploy));
        keployApp.appliedMiddleware = true;
        keploy.runTests();
        return keployApp;
    }
    // copy the properties and methods of exported Function object into wrapped Funtion(keployWrappedExpress).
    // In order to prevent "express._Method_ or express._Field_ is not declared" error.
    (0, merge_descriptors_1.default)(keployWrappedExpress, expressApp, false);
    exports = keployWrappedExpress;
    return exports;
});
