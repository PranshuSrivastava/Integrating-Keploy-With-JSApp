"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getExecutionContext = exports.createExecutionContext = void 0;
/* eslint-disable @typescript-eslint/no-unused-vars */
/* eslint-disable @typescript-eslint/no-explicit-any */
const async_hooks_1 = __importDefault(require("async_hooks"));
const executionContextMap = new Map();
const asyncHook = async_hooks_1.default.createHook({ init, destroy });
asyncHook.enable();
function init(asyncId, type, triggerAsyncId) {
    const parentContext = executionContextMap.get(triggerAsyncId);
    if (!parentContext)
        return;
    executionContextMap.set(asyncId, { context: parentContext.context });
}
function destroy(asyncId) {
    executionContextMap.delete(asyncId);
}
function createExecutionContext(context) {
    const asyncId = async_hooks_1.default.executionAsyncId();
    executionContextMap.set(asyncId, { context });
}
exports.createExecutionContext = createExecutionContext;
function getExecutionContext() {
    const asyncId = async_hooks_1.default.executionAsyncId();
    return executionContextMap.get(asyncId);
}
exports.getExecutionContext = getExecutionContext;
